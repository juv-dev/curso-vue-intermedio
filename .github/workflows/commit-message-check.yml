name: Check Commit Message
on:
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened, edited]

jobs:
  validate-commit-message:
    name: Validar Mensajes de Commit
    runs-on: ubuntu-latest
    
    steps:
      - name: Validate PR title
        uses: docker://node:20-alpine
        with:
          entrypoint: /bin/sh
          args: -c |
            # Instalar commitlint globalmente
            npm install -g @commitlint/cli @commitlint/config-conventional
            
            # Crear configuración
            cat > /tmp/commitlint.config.js << 'EOL'
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [2, 'always', ['feat', 'fix']],
    'header-max-length': [2, 'always', 100],
    'scope-case': [2, 'always', 'kebab-case'],
    'subject-case': [0],
    'scope-empty': [0]
  }
};
EOL

            # Validar título
            echo "Validando: ${{ github.event.pull_request.title }}"
            echo "${{ github.event.pull_request.title }}" | commitlint --edit -c /tmp/commitlint.config.js || {
              echo "::error::❌ El título del PR debe seguir el formato: 'tipo(ámbito): descripción'"
              echo "Formatos válidos:"
              echo "- feat: descripción"
              echo "- feat(ámbito): descripción"
              echo "- fix: descripción"
              echo "- fix(ámbito): descripción"
              exit 1
            }
            echo "✅ El título del PR es válido"